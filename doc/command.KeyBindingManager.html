<!DOCTYPE html>
<html lang="en">
<head>
    <title>command.KeyBindingManager</title>
    <link rel="stylesheet" href="../assets/css/bootstrap.css">
    <link rel="stylesheet" href="../assets/css/font-awesome.css">
    <link rel="stylesheet" href="../assets/css/main.css">
    <!--[if IE 7]>
    <link rel="stylesheet" href="../assets/css/font-awesome-ie7.css">
    <![endif]-->
    <script type="text/javascript" src="../assets/js/jquery-1.7.js"></script>
    <script type="text/javascript" src="../assets/js/bootstrap.js"></script>
    <script type="text/javascript" src="../assets/js/main.js"></script>
</head>
<body>
<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="brand" href="./index.html">Brackets API</a>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    <li><a href="#dependencies">Dependencies</a></li>
                    <li><a href="#variables">Variables</a></li>
                    <li><a href="#functions">Functions</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="span12">
            <div class="page-header">
                <h1>command.KeyBindingManager</h1>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="span3">
            <div class="left-section">
                <ul class="nav nav-list">
                    <li class="nav-header">
                        <a href="#" id="toggle-other-modules"><i class="icon-folder-close"></i> Modules (109)</a>
                    </li>
                </ul>
                <ul id="other-module" class="nav nav-list">
                    <li><a href="brackets.html">brackets</a></li>
                    <li><a href="command.CommandManager.html">command.CommandManager</a></li>
                    <li><a href="command.Commands.html">command.Commands</a></li>
                    <li><a href="command.KeyBindingManager.html">command.KeyBindingManager</a></li>
                    <li><a href="command.Menus.html">command.Menus</a></li>
                    <li><a href="debug.DebugCommandHandlers.html">debug.DebugCommandHandlers</a></li>
                    <li><a href="document.ChangedDocumentTracker.html">document.ChangedDocumentTracker</a></li>
                    <li><a href="document.DocumentCommandHandlers.html">document.DocumentCommandHandlers</a></li>
                    <li><a href="document.DocumentManager.html">document.DocumentManager</a></li>
                    <li><a href="document.TextRange.html">document.TextRange</a></li>
                    <li><a href="editor.CodeHintList.html">editor.CodeHintList</a></li>
                    <li><a href="editor.CodeHintManager.html">editor.CodeHintManager</a></li>
                    <li><a href="editor.CSSInlineEditor.html">editor.CSSInlineEditor</a></li>
                    <li><a href="editor.Editor.html">editor.Editor</a></li>
                    <li><a href="editor.EditorCommandHandlers.html">editor.EditorCommandHandlers</a></li>
                    <li><a href="editor.EditorManager.html">editor.EditorManager</a></li>
                    <li><a href="editor.EditorUtils.html">editor.EditorUtils</a></li>
                    <li><a href="editor.InlineTextEditor.html">editor.InlineTextEditor</a></li>
                    <li><a href="editor.InlineWidget.html">editor.InlineWidget</a></li>
                    <li><a href="editor.MultiRangeInlineEditor.html">editor.MultiRangeInlineEditor</a></li>
                    <li><a href="file.FileUtils.html">file.FileUtils</a></li>
                    <li><a href="file.NativeFileError.html">file.NativeFileError</a></li>
                    <li><a href="file.NativeFileSystem.html">file.NativeFileSystem</a></li>
                    <li><a href="help.HelpCommandHandlers.html">help.HelpCommandHandlers</a></li>
                    <li><a href="language.CSSUtils.html">language.CSSUtils</a></li>
                    <li><a href="language.HTMLUtils.html">language.HTMLUtils</a></li>
                    <li><a href="language.JSLintUtils.html">language.JSLintUtils</a></li>
                    <li><a href="language.JSUtils.html">language.JSUtils</a></li>
                    <li><a href="LiveDevelopment.Agents.ConsoleAgent.html">LiveDevelopment.Agents.ConsoleAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.CSSAgent.html">LiveDevelopment.Agents.CSSAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.DOMAgent.html">LiveDevelopment.Agents.DOMAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.DOMHelpers.html">LiveDevelopment.Agents.DOMHelpers</a></li>
                    <li><a href="LiveDevelopment.Agents.DOMNode.html">LiveDevelopment.Agents.DOMNode</a></li>
                    <li><a href="LiveDevelopment.Agents.EditAgent.html">LiveDevelopment.Agents.EditAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.GotoAgent.html">LiveDevelopment.Agents.GotoAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.HighlightAgent.html">LiveDevelopment.Agents.HighlightAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.NetworkAgent.html">LiveDevelopment.Agents.NetworkAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.RemoteAgent.html">LiveDevelopment.Agents.RemoteAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.RemoteFunctions.html">LiveDevelopment.Agents.RemoteFunctions</a></li>
                    <li><a href="LiveDevelopment.Agents.ScriptAgent.html">LiveDevelopment.Agents.ScriptAgent</a></li>
                    <li><a href="LiveDevelopment.Documents.CSSDocument.html">LiveDevelopment.Documents.CSSDocument</a></li>
                    <li><a href="LiveDevelopment.Documents.HTMLDocument.html">LiveDevelopment.Documents.HTMLDocument</a></li>
                    <li><a href="LiveDevelopment.Documents.JSDocument.html">LiveDevelopment.Documents.JSDocument</a></li>
                    <li><a href="LiveDevelopment.Inspector.Inspector.html">LiveDevelopment.Inspector.Inspector</a></li>
                    <li><a href="LiveDevelopment.LiveDevelopment.html">LiveDevelopment.LiveDevelopment</a></li>
                    <li><a href="LiveDevelopment.main.html">LiveDevelopment.main</a></li>
                    <li><a href="nls.de.strings.html">nls.de.strings</a></li>
                    <li><a href="nls.de.urls.html">nls.de.urls</a></li>
                    <li><a href="nls.es.strings.html">nls.es.strings</a></li>
                    <li><a href="nls.es.urls.html">nls.es.urls</a></li>
                    <li><a href="nls.fr.strings.html">nls.fr.strings</a></li>
                    <li><a href="nls.fr.urls.html">nls.fr.urls</a></li>
                    <li><a href="nls.it.strings.html">nls.it.strings</a></li>
                    <li><a href="nls.it.urls.html">nls.it.urls</a></li>
                    <li><a href="nls.ja.strings.html">nls.ja.strings</a></li>
                    <li><a href="nls.nb.strings.html">nls.nb.strings</a></li>
                    <li><a href="nls.pt-br.strings.html">nls.pt-br.strings</a></li>
                    <li><a href="nls.pt-br.urls.html">nls.pt-br.urls</a></li>
                    <li><a href="nls.root.strings.html">nls.root.strings</a></li>
                    <li><a href="nls.root.urls.html">nls.root.urls</a></li>
                    <li><a href="nls.ru.strings.html">nls.ru.strings</a></li>
                    <li><a href="nls.ru.urls.html">nls.ru.urls</a></li>
                    <li><a href="nls.strings.html">nls.strings</a></li>
                    <li><a href="nls.tr.strings.html">nls.tr.strings</a></li>
                    <li><a href="nls.urls.html">nls.urls</a></li>
                    <li><a href="preferences.PreferencesDialogs.html">preferences.PreferencesDialogs</a></li>
                    <li><a href="preferences.PreferencesManager.html">preferences.PreferencesManager</a></li>
                    <li><a href="preferences.PreferenceStorage.html">preferences.PreferenceStorage</a></li>
                    <li><a href="project.FileIndexManager.html">project.FileIndexManager</a></li>
                    <li><a href="project.FileSyncManager.html">project.FileSyncManager</a></li>
                    <li><a href="project.FileViewController.html">project.FileViewController</a></li>
                    <li><a href="project.ProjectManager.html">project.ProjectManager</a></li>
                    <li><a href="project.SidebarView.html">project.SidebarView</a></li>
                    <li><a href="project.WorkingSetSort.html">project.WorkingSetSort</a></li>
                    <li><a href="project.WorkingSetView.html">project.WorkingSetView</a></li>
                    <li><a href="search.FindInFiles.html">search.FindInFiles</a></li>
                    <li><a href="search.FindReplace.html">search.FindReplace</a></li>
                    <li><a href="search.QuickOpen.html">search.QuickOpen</a></li>
                    <li><a href="strings.html">strings</a></li>
                    <li><a href="utils.AppInit.html">utils.AppInit</a></li>
                    <li><a href="utils.Async.html">utils.Async</a></li>
                    <li><a href="utils.BuildInfoUtils.html">utils.BuildInfoUtils</a></li>
                    <li><a href="utils.CollectionUtils.html">utils.CollectionUtils</a></li>
                    <li><a href="utils.ExtensionLoader.html">utils.ExtensionLoader</a></li>
                    <li><a href="utils.ExtensionUtils.html">utils.ExtensionUtils</a></li>
                    <li><a href="utils.Global.html">utils.Global</a></li>
                    <li><a href="utils.KeyEvent.html">utils.KeyEvent</a></li>
                    <li><a href="utils.NativeApp.html">utils.NativeApp</a></li>
                    <li><a href="utils.PerfUtils.html">utils.PerfUtils</a></li>
                    <li><a href="utils.Resizer.html">utils.Resizer</a></li>
                    <li><a href="utils.ShellAPI.html">utils.ShellAPI</a></li>
                    <li><a href="utils.StringUtils.html">utils.StringUtils</a></li>
                    <li><a href="utils.TokenUtils.html">utils.TokenUtils</a></li>
                    <li><a href="utils.UpdateNotification.html">utils.UpdateNotification</a></li>
                    <li><a href="utils.UrlParams.html">utils.UrlParams</a></li>
                    <li><a href="utils.ViewUtils.html">utils.ViewUtils</a></li>
                    <li><a href="view.ViewCommandHandlers.html">view.ViewCommandHandlers</a></li>
                    <li><a href="widgets.bootstrap-alerts.html">widgets.bootstrap-alerts</a></li>
                    <li><a href="widgets.bootstrap-buttons.html">widgets.bootstrap-buttons</a></li>
                    <li><a href="widgets.bootstrap-dropdown.html">widgets.bootstrap-dropdown</a></li>
                    <li><a href="widgets.bootstrap-modal.html">widgets.bootstrap-modal</a></li>
                    <li><a href="widgets.bootstrap-popover.html">widgets.bootstrap-popover</a></li>
                    <li><a href="widgets.bootstrap-scrollspy.html">widgets.bootstrap-scrollspy</a></li>
                    <li><a href="widgets.bootstrap-tabs.html">widgets.bootstrap-tabs</a></li>
                    <li><a href="widgets.bootstrap-twipsy.html">widgets.bootstrap-twipsy</a></li>
                    <li><a href="widgets.Dialogs.html">widgets.Dialogs</a></li>
                    <li><a href="widgets.ModalBar.html">widgets.ModalBar</a></li>
                    <li><a href="widgets.PopUpManager.html">widgets.PopUpManager</a></li>
                    <li><a href="widgets.StatusBar.html">widgets.StatusBar</a></li>
                </ul>
            </div>
        </div>
        <div class="span9">
            <section>
                <div id="description">
                    <p>Manages the mapping of keyboard inputs to commands.</p>
                </div>
            </section>

            <section id="dependencies">
                <h3>Dependencies</h3>
                <ul class="nav nav-list">
                    <li><a href="command.CommandManager.html">command.CommandManager</a></li>
                    <li><a href="strings.html">strings</a></li>
                    <li><a href="text!base-config.keyboard.json.html">text!base-config.keyboard.json</a></li>
                    <li><a href="utils.Global.html">utils.Global</a></li>
                    <li><a href="utils.KeyEvent.html">utils.KeyEvent</a></li>
                </ul>
            </section>

            <section id="variables">
                <h3>Variables <label class="checkbox">
                    <input class="toggle-public" type="checkbox"> Show Private Members
                </label></h3>
                <!--<ul>-->
                <div class="member private">

                    <span class="pull-right scope">
                        Private
                        
                    </span>
                    <h4>_commandMap</h4>
                    <dl>
                            <dt>Type</dt>
                                <dd>!Object.<string, </dd>
                            <dt>Private</dt>
                    </dl>
                    <p>Maps commandID to the list of shortcuts that are bound to it.</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>var _commandMap = {};</code></pre>
                </div>
                <div class="member private">

                    <span class="pull-right scope">
                        Private
                        
                    </span>
                    <h4>_enabled</h4>
                    <dl>
                            <dt>Private</dt>
                    </dl>
                    <p>Allow clients to toggle key binding</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>var _enabled = true;</code></pre>
                </div>
                <div class="member private">

                    <span class="pull-right scope">
                        Private
                        
                    </span>
                    <h4>_keyMap</h4>
                    <dl>
                            <dt>Type</dt>
                                <dd>!Object.<string, </dd>
                            <dt>Private</dt>
                    </dl>
                    <p>Maps normalized shortcut descriptor to key binding info.</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>var _keyMap = {};</code></pre>
                </div>
                <!--</ul>-->
            </section>

            <section id="functions">
                <h3>Functions <label class="checkbox">
                    <input class="toggle-public" type="checkbox"> Show Private Members
                </label></h3>
                <div class="member private">
                    <span class="pull-right scope">
                        Private
                        
                    </span>
                    <h4>_addBinding</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>commandID</dt>
                            <dd>(<em>string</em>) - </dd>
                            <dt>string,</dt>
                            <dd>(<em>string, key:</em>) - displayKey: string}}} keyBinding - a single shortcut.</dd>
                            <dt>platform</dt>
                            <dd>(<em>?string</em>) - - undefined indicates all platforms</dd>
                            <dt>Returns</dt>
                            <dd>(<em>?key:</em>) - string, displayKey:String}} Returns a record for valid key bindings.</dd>
                    </dl>
                    <p></p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function _addBinding(commandID, keyBinding, platform) {
        var key,
            result = null,
            normalized,
            normalizedDisplay,
            explicitPlatform = keyBinding.platform || platform,
            targetPlatform = explicitPlatform || brackets.platform,
            command,
            bindingsToDelete = [],
            existing;
        
        &#x2F;&#x2F; if the request does not specify an explicit platform, and we&#39;re
        &#x2F;&#x2F; currently on a mac, then replace Ctrl with Cmd.
        key = (keyBinding.key) || keyBinding;
        if (brackets.platform === &quot;mac&quot; &amp;&amp; explicitPlatform === undefined) {
            key = key.replace(&quot;Ctrl&quot;, &quot;Cmd&quot;);
            if (keyBinding.displayKey !== undefined) {
                keyBinding.displayKey = keyBinding.displayKey.replace(&quot;Ctrl&quot;, &quot;Cmd&quot;);
            }
        }
        normalized = normalizeKeyDescriptorString(key);
        
        &#x2F;&#x2F; skip if the key binding is invalid 
        if (!normalized) {
            console.log(&quot;Failed to normalize &quot; + key);
            return null;
        }
        
        &#x2F;&#x2F; check for duplicate key bindings
        existing = _keyMap[normalized];
        
        &#x2F;&#x2F; for cross-platform compatibility
        if (exports.useWindowsCompatibleBindings) {
            &#x2F;&#x2F; windows-only key bindings are used as the default binding
            &#x2F;&#x2F; only if a default binding wasn&#39;t already defined
            if (explicitPlatform === &quot;win&quot;) {
                &#x2F;&#x2F; search for a generic or platform-specific binding if it
                &#x2F;&#x2F; already exists
                if (existing &amp;&amp;
                        (!existing.explicitPlatform || existing.explicitPlatform === brackets.platform)) {
                    &#x2F;&#x2F; do not clobber existing binding with windows-only binding
                    return null;
                }
                
                &#x2F;&#x2F; target this windows binding for the current platform
                targetPlatform = brackets.platform;
            }
        }
        
        &#x2F;&#x2F; skip if this binding doesn&#39;t match the current platform
        if (targetPlatform !== brackets.platform) {
            return null;
        }
        
        &#x2F;&#x2F; skip if the key is already assigned explicitly for this platform
        if (existing) {
            if (!existing.explicitPlatform) {
                &#x2F;&#x2F; remove existing generic bindings, then re-map this binding
                &#x2F;&#x2F; to the new command
                removeBinding(normalized);
            } else {
                &#x2F;&#x2F; do not re-assign a platform-specific key binding
                console.log(&quot;Cannot assign &quot; + normalized + &quot; to &quot; + commandID +
                            &quot;. It is already assigned to &quot; + _keyMap[normalized].commandID);
                return null;
            }
        }
        
        &#x2F;&#x2F; delete existing bindings when
        &#x2F;&#x2F; (1) replacing a windows-compatible binding with a generic or
        &#x2F;&#x2F;     platform-specific binding
        &#x2F;&#x2F; (2) replacing a generic binding with a platform-specific binding
        var existingBindings = _commandMap[commandID] || [],
            isWindowsCompatible,
            isReplaceGeneric;
        
        existingBindings.forEach(function (binding) {
            &#x2F;&#x2F; remove windows-only bindings in _commandMap
            isWindowsCompatible = exports.useWindowsCompatibleBindings &amp;&amp;
                binding.explicitPlatform === &quot;win&quot;;
            
            &#x2F;&#x2F; remove existing generic binding
            isReplaceGeneric = !binding.explicitPlatform &amp;&amp;
                explicitPlatform;
            
            if (isWindowsCompatible || isReplaceGeneric) {
                bindingsToDelete.push(binding);
            }
        });
                
        &#x2F;&#x2F; remove generic or windows-compatible bindigns
        bindingsToDelete.forEach(function (binding) {
            removeBinding(binding.key);
        });
        
        &#x2F;&#x2F; optional display-friendly string (e.g. CMD-+ instead of CMD-=)
        normalizedDisplay = (keyBinding.displayKey) ? normalizeKeyDescriptorString(keyBinding.displayKey) : normalized;
        
        &#x2F;&#x2F; 1-to-many commandID mapping to key binding
        if (!_commandMap[commandID]) {
            _commandMap[commandID] = [];
        }
        
        result = {
            key                 : normalized,
            displayKey          : normalizedDisplay,
            explicitPlatform    : explicitPlatform
        };
        
        _commandMap[commandID].push(result);
        
        &#x2F;&#x2F; 1-to-1 key binding to commandID
        _keyMap[normalized] = {
            commandID           : commandID,
            key                 : normalized,
            displayKey          : normalizedDisplay,
            explicitPlatform    : explicitPlatform
        };
        
        &#x2F;&#x2F; notify listeners
        command = CommandManager.get(commandID);
        
        if (command) {
            $(command).triggerHandler(&quot;keyBindingAdded&quot;, [result]);
        }
        
        return result;
    }</code></pre>
                </div>
                <div class="member private">
                    <span class="pull-right scope">
                        Private
                        
                    </span>
                    <h4>_buildKeyDescriptor</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>hasCtrl</dt>
                            <dd>(<em>boolean</em>) - Is Ctrl key enabled</dd>
                            <dt>hasAlt</dt>
                            <dd>(<em>boolean</em>) - Is Alt key enabled</dd>
                            <dt>hasShift</dt>
                            <dd>(<em>boolean</em>) - Is Shift key enabled</dd>
                            <dt>key</dt>
                            <dd>(<em>string</em>) - The key that's pressed</dd>
                            <dt>Returns</dt>
                            <dd>(<em>string</em>) - The normalized key descriptor</dd>
                    </dl>
                    <p>Initialize an empty keymap as the current keymap. It overwrites the current keymap if there is one.<br />builds the keyDescriptor string from the given parts</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function _buildKeyDescriptor(hasMacCtrl, hasCtrl, hasAlt, hasShift, key) {
        if (!key) {
            console.log(&quot;KeyBindingManager _buildKeyDescriptor() - No key provided!&quot;);
            return &quot;&quot;;
        }
        
        var keyDescriptor = [];
       
        if (hasMacCtrl) {
            keyDescriptor.push(&quot;Ctrl&quot;);
        }
        if (hasAlt) {
            keyDescriptor.push(&quot;Alt&quot;);
        }
        if (hasShift) {
            keyDescriptor.push(&quot;Shift&quot;);
        }

        if (hasCtrl) {
            &#x2F;&#x2F; Windows display Ctrl first, Mac displays Command symbol last
            if (brackets.platform === &quot;mac&quot;) {
                keyDescriptor.push(&quot;Cmd&quot;);
            } else {
                keyDescriptor.unshift(&quot;Ctrl&quot;);
            }
        }

        keyDescriptor.push(key);
        
        return keyDescriptor.join(&quot;-&quot;);
    }</code></pre>
                </div>
                <div class="member private">
                    <span class="pull-right scope">
                        Private
                        
                    </span>
                    <h4>_handleCommandRegistered</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>event</dt>
                            <dd>(<em>$.Event</em>) - jQuery event</dd>
                            <dt>command</dt>
                            <dd>(<em>Command</em>) - Newly registered command</dd>
                    </dl>
                    <p>Adds default key bindings when commands are registered to CommandManager</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function _handleCommandRegistered(event, command) {
        var commandId   = command.getID(),
            defaults    = KeyboardPrefs[commandId];
        
        if (defaults) {
            addBinding(commandId, defaults);
        }
    }</code></pre>
                </div>
                <div class="member private">
                    <span class="pull-right scope">
                        Private
                        
                    </span>
                    <h4>_isKeyAssigned</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>A</dt>
                            <dd>(<em>string</em>) - normalized key-description string.</dd>
                            <dt>Returns</dt>
                            <dd>(<em>boolean</em>) - true if the key is already assigned, false otherwise.</dd>
                    </dl>
                    <p></p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function _isKeyAssigned(key) {
        return (_keyMap[key] !== undefined);
    }</code></pre>
                </div>
                <div class="member private">
                    <span class="pull-right scope">
                        Private
                        
                    </span>
                    <h4>_mapKeycodeToKey</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>The</dt>
                            <dd>(<em>number</em>) - keycode from the keyboard event.</dd>
                            <dt>The</dt>
                            <dd>(<em>string</em>) - current best guess at what the key is.</dd>
                            <dt>Returns</dt>
                            <dd>(<em>string</em>) - If the key is OS-inconsistent, the correct key; otherwise, the original key.</dd>
                    </dl>
                    <p>Looks for keycodes that have os-inconsistent keys and fixes them.</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function _mapKeycodeToKey(keycode, key) {
        &#x2F;&#x2F; If keycode represents one of the digit keys (0-9), then return the corresponding digit
        &#x2F;&#x2F; by subtracting KeyEvent.DOM_VK_0 from keycode. ie. [48-57] --&gt; [0-9]
        if (keycode &gt;= KeyEvent.DOM_VK_0 &amp;&amp; keycode &lt;= KeyEvent.DOM_VK_9) {
            return String(keycode - KeyEvent.DOM_VK_0);
        &#x2F;&#x2F; Do the same with the numpad numbers
        &#x2F;&#x2F; by subtracting KeyEvent.DOM_VK_NUMPAD0 from keycode. ie. [96-105] --&gt; [0-9]
        } else if (keycode &gt;= KeyEvent.DOM_VK_NUMPAD0 &amp;&amp; keycode &lt;= KeyEvent.DOM_VK_NUMPAD9) {
            return String(keycode - KeyEvent.DOM_VK_NUMPAD0);
        }
        
        
        switch (keycode) {
        case KeyEvent.DOM_VK_SEMICOLON:
            return &quot;;&quot;;
        case KeyEvent.DOM_VK_EQUALS:
            return &quot;=&quot;;
        case KeyEvent.DOM_VK_COMMA:
            return &quot;,&quot;;
        case KeyEvent.DOM_VK_SUBTRACT:
        case KeyEvent.DOM_VK_DASH:
            return &quot;-&quot;;
        case KeyEvent.DOM_VK_ADD:
            return &quot;+&quot;;
        case KeyEvent.DOM_VK_DECIMAL:
        case KeyEvent.DOM_VK_PERIOD:
            return &quot;.&quot;;
        case KeyEvent.DOM_VK_DIVIDE:
        case KeyEvent.DOM_VK_SLASH:
            return &quot;&#x2F;&quot;;
        case KeyEvent.DOM_VK_BACK_QUOTE:
            return &quot;`&quot;;
        case KeyEvent.DOM_VK_OPEN_BRACKET:
            return &quot;[&quot;;
        case KeyEvent.DOM_VK_BACK_SLASH:
            return &quot;\\&quot;;
        case KeyEvent.DOM_VK_CLOSE_BRACKET:
            return &quot;]&quot;;
        case KeyEvent.DOM_VK_QUOTE:
            return &quot;&#39;&quot;;
        default:
            return key;
        }
    }</code></pre>
                </div>
                <div class="member private public">
                    <span class="pull-right scope">
                        Private
                        Public API
                    </span>
                    <h4>_reset</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                    </dl>
                    <p></p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function _reset() {
        _keyMap = {};
        _commandMap = {};
    }</code></pre>
                </div>
                <div class="member private">
                    <span class="pull-right scope">
                        Private
                        
                    </span>
                    <h4>_translateKeyboardEvent</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                    </dl>
                    <p>Takes a keyboard event and translates it into a key in a key map</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function _translateKeyboardEvent(event) {
        var hasMacCtrl = (brackets.platform === &quot;mac&quot;) ? (event.ctrlKey) : false,
            hasCtrl = (brackets.platform !== &quot;mac&quot;) ? (event.ctrlKey) : (event.metaKey),
            hasAlt = (event.altKey),
            hasShift = (event.shiftKey),
            key = String.fromCharCode(event.keyCode);
        
        &#x2F;&#x2F;From the W3C, if we can get the KeyboardEvent.keyIdentifier then look here
        &#x2F;&#x2F;As that will let us use keys like then function keys &quot;F5&quot; for commands. The
        &#x2F;&#x2F;full set of values we can use is here
        &#x2F;&#x2F;http:&#x2F;&#x2F;www.w3.org&#x2F;TR&#x2F;2007&#x2F;WD-DOM-Level-3-Events-20071221&#x2F;keyset.html#KeySet-Set
        var ident = event.keyIdentifier;
        if (ident) {
            if (ident.charAt(0) === &quot;U&quot; &amp;&amp; ident.charAt(1) === &quot;+&quot;) {
                &#x2F;&#x2F;This is a unicode code point like &quot;U+002A&quot;, get the 002A and use that
                key = String.fromCharCode(parseInt(ident.substring(2), 16));
            } else {
                &#x2F;&#x2F;This is some non-character key, just use the raw identifier
                key = ident;
            }
        }
        
        &#x2F;&#x2F; Translate some keys to their common names
        if (key === &quot;\t&quot;) {
            key = &quot;Tab&quot;;
        } else if (key === &quot; &quot;) {
            key = &quot;Space&quot;;
        } else {
            key = _mapKeycodeToKey(event.keyCode, key);
        }

        return _buildKeyDescriptor(hasMacCtrl, hasCtrl, hasAlt, hasShift, key);
    }</code></pre>
                </div>
                <div class="member public">
                    <span class="pull-right scope">
                        
                        Public API
                    </span>
                    <h4>addBinding</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>commandID</dt>
                            <dd>(<em>!string</em>) - </dd>
                            <dt>string,</dt>
                            <dd>(<em>?(key:</em>) - displayKey: string} | Array.<{key: string, displayKey: string, platform: string}>)} keyBindings</dd>
                            <dt>platform</dt>
                            <dd>(<em>?string</em>) - - the target OS of the keyBindings either</dd>
                            <dt>Returns</dt>
                            <dd>(<em>key:</em>) - string, displayKey:String}|Array.<{key: string, displayKey:String}>}</dd>
                    </dl>
                    <p>Add one or more key bindings to a particular Command.</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function addBinding(commandID, keyBindings, platform) {
        if ((commandID === null) || (commandID === undefined) || !keyBindings) {
            return;
        }
        
        var normalizedBindings = [],
            results;

        if (Array.isArray(keyBindings)) {
            var keyBinding;
            results = [];
            
            keyBindings.forEach(function addSingleBinding(keyBindingRequest) {
                &#x2F;&#x2F; attempt to add keybinding
                keyBinding = _addBinding(commandID, keyBindingRequest, keyBindingRequest.platform);
                
                if (keyBinding) {
                    results.push(keyBinding);
                }
            });
        } else {
            results = _addBinding(commandID, keyBindings, platform);
        }
        
        return results;
    }</code></pre>
                </div>
                <div class="member public">
                    <span class="pull-right scope">
                        
                        Public API
                    </span>
                    <h4>formatKeyDescriptor</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>descriptor</dt>
                            <dd>(<em>!string</em>) - Normalized key descriptor.</dd>
                            <dt>Returns</dt>
                            <dd>(<em>!string</em>) - Display/Operating system appropriate string</dd>
                    </dl>
                    <p>Convert normalized key representation to display appropriate for platform.</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function formatKeyDescriptor(descriptor) {
        var displayStr;
        
        if (brackets.platform === &quot;mac&quot;) {
            displayStr = descriptor.replace(&#x2F;-&#x2F;g, &quot;&quot;);          &#x2F;&#x2F; remove dashes
            displayStr = displayStr.replace(&quot;Ctrl&quot;, &quot;\u2303&quot;);  &#x2F;&#x2F; Ctrl &gt; control symbol
            displayStr = displayStr.replace(&quot;Cmd&quot;, &quot;\u2318&quot;);   &#x2F;&#x2F; Cmd &gt; command symbol
            displayStr = displayStr.replace(&quot;Shift&quot;, &quot;\u21E7&quot;); &#x2F;&#x2F; Shift &gt; shift symbol
            displayStr = displayStr.replace(&quot;Alt&quot;, &quot;\u2325&quot;);   &#x2F;&#x2F; Alt &gt; option symbol
        } else {
            displayStr = descriptor.replace(&quot;Ctrl&quot;, Strings.KEYBOARD_CTRL);   &#x2F;&#x2F; Ctrl
            displayStr = displayStr.replace(&quot;Shift&quot;, Strings.KEYBOARD_SHIFT); &#x2F;&#x2F; Shift &gt; shift symbol
            displayStr = displayStr.replace(&quot;Space&quot;, Strings.KEYBOARD_SPACE); &#x2F;&#x2F; Alt &gt; option symbol
            displayStr = displayStr.replace(&#x2F;-&#x2F;g, &quot;+&quot;);
        }

        return displayStr;
    }</code></pre>
                </div>
                <div class="member public">
                    <span class="pull-right scope">
                        
                        Public API
                    </span>
                    <h4>getKeyBindings</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>command</dt>
                            <dd>(<em>!string</em>) - - A command ID</dd>
                            <dt>Returns</dt>
                            <dd>(<em>!Array.&lt;key:</em>) - string, displayKey: string}}>} An array of associated key bindings.</dd>
                    </dl>
                    <p>Retrieve key bindings currently associated with a command</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function getKeyBindings(commandID) {
        var bindings = _commandMap[commandID];
        return bindings || [];
    }</code></pre>
                </div>
                <div class="member public">
                    <span class="pull-right scope">
                        
                        Public API
                    </span>
                    <h4>getKeymap</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                    </dl>
                    <p>Returns a copy of the keymap</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function getKeymap() {
        return $.extend({}, _keyMap);
    }</code></pre>
                </div>
                <div class="member public">
                    <span class="pull-right scope">
                        
                        Public API
                    </span>
                    <h4>handleKey</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>A</dt>
                            <dd>(<em>string</em>) - key-description string.</dd>
                            <dt>Returns</dt>
                            <dd>(<em>boolean</em>) - true if the key was processed, false otherwise</dd>
                    </dl>
                    <p>Process the keybinding for the current key.</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function handleKey(key) {
        if (_enabled &amp;&amp; _keyMap[key]) {
            &#x2F;&#x2F; The execute() function returns a promise because some commands are async.
            &#x2F;&#x2F; Generally, commands decide whether they can run or not synchronously,
            &#x2F;&#x2F; and reject immediately, so we can test for that synchronously.
            var promise = CommandManager.execute(_keyMap[key].commandID);
            return (promise.state() === &quot;rejected&quot;) ? false : true;
        }
        return false;
    }

    &#x2F;&#x2F; TODO (issue #414): Replace this temporary fix with a more robust solution to handle focus and modality</code></pre>
                </div>
                <div class="member public">
                    <span class="pull-right scope">
                        
                        Public API
                    </span>
                    <h4>init</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                    </dl>
                    <p>Install keydown event listener.</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function init() {
        &#x2F;&#x2F; init
        window.document.body.addEventListener(
            &quot;keydown&quot;,
            function (event) {
                if (handleKey(_translateKeyboardEvent(event))) {
                    event.stopPropagation();
                    event.preventDefault();
                }
            },
            true
        );
        
        exports.useWindowsCompatibleBindings = (brackets.platform !== &quot;mac&quot;)
            &amp;&amp; (brackets.platform !== &quot;win&quot;);
    }
    
    $(CommandManager).on(&quot;commandRegistered&quot;, _handleCommandRegistered);

    &#x2F;&#x2F; unit test only
    exports._reset = _reset;

    &#x2F;&#x2F; Define public API
    exports.init = init;
    exports.getKeymap = getKeymap;
    exports.handleKey = handleKey;
    exports.setEnabled = setEnabled;
    exports.addBinding = addBinding;
    exports.removeBinding = removeBinding;
    exports.formatKeyDescriptor = formatKeyDescriptor;
    exports.getKeyBindings = getKeyBindings;</code></pre>
                </div>
                <div class="member">
                    <span class="pull-right scope">
                        
                        
                    </span>
                    <h4>normalizeKeyDescriptorString</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>The</dt>
                            <dd>(<em>string</em>) - string for a key descriptor, can be in any order, the result will be Ctrl-Alt-Shift-<Key></dd>
                            <dt>Returns</dt>
                            <dd>(<em>string</em>) - The normalized key descriptor or null if the descriptor invalid</dd>
                    </dl>
                    <p>normalizes the incoming key descriptor so the modifier keys are always specified in the correct order</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function normalizeKeyDescriptorString(origDescriptor) {
        var hasMacCtrl = false,
            hasCtrl = false,
            hasAlt = false,
            hasShift = false,
            key = &quot;&quot;,
            error = false;

        function _compareModifierString(left, right) {
            if (!left || !right) {
                return false;
            }
            left = left.trim().toLowerCase();
            right = right.trim().toLowerCase();
            
            return (left.length &gt; 0 &amp;&amp; left === right);
        }
        
        origDescriptor.split(&quot;-&quot;).forEach(function parseDescriptor(ele, i, arr) {
            if (_compareModifierString(&quot;ctrl&quot;, ele)) {
                if (brackets.platform === &quot;mac&quot;) {
                    hasMacCtrl = true;
                } else {
                    hasCtrl = true;
                }
            } else if (_compareModifierString(&quot;cmd&quot;, ele)) {
                hasCtrl = true;
            } else if (_compareModifierString(&quot;alt&quot;, ele)) {
                hasAlt = true;
            } else if (_compareModifierString(&quot;opt&quot;, ele)) {
                hasAlt = true;
            } else if (_compareModifierString(&quot;shift&quot;, ele)) {
                hasShift = true;
            } else if (key.length &gt; 0) {
                console.log(&quot;KeyBindingManager normalizeKeyDescriptorString() - Multiple keys defined. Using key: &quot; + key + &quot; from: &quot; + origDescriptor);
                error = true;
            } else {
                key = ele;
            }
        });
        
        if (error) {
            return null;
        }

        &#x2F;&#x2F; Check to see if the binding is for &quot;-&quot;.
        if (key === &quot;&quot; &amp;&amp; origDescriptor.search(&#x2F;^.+--$&#x2F;) !== -1) {
            key = &quot;-&quot;;
        }
        
        &#x2F;&#x2F; &#39;+&#39; char is valid if it&#39;s the only key. Keyboard shortcut strings should use
        &#x2F;&#x2F; unicode characters (unescaped). Keyboard shortcut display strings may use
        &#x2F;&#x2F; unicode escape sequences (e.g. \u20AC euro sign)
        if ((key.indexOf(&quot;+&quot;)) &gt;= 0 &amp;&amp; (key.length &gt; 1)) {
            return null;
        }
        
        return _buildKeyDescriptor(hasMacCtrl, hasCtrl, hasAlt, hasShift, key);
    }</code></pre>
                </div>
                <div class="member public">
                    <span class="pull-right scope">
                        
                        Public API
                    </span>
                    <h4>removeBinding</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>key</dt>
                            <dd>(<em>!string</em>) - - a key-description string that may or may not be normalized.</dd>
                            <dt>platform</dt>
                            <dd>(<em>?string</em>) - - OS from which to remove the binding (all platforms if unspecified)</dd>
                    </dl>
                    <p>Remove a key binding from _keymap</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function removeBinding(key, platform) {
        if (!key || ((platform !== null) &amp;&amp; (platform !== undefined) &amp;&amp; (platform !== brackets.platform))) {
            return;
        }

        var normalizedKey = normalizeKeyDescriptorString(key);
        
        if (!normalizedKey) {
            console.log(&quot;Fail to nomalize &quot; + key);
        } else if (_isKeyAssigned(normalizedKey)) {
            var binding = _keyMap[normalizedKey],
                command = CommandManager.get(binding.commandID),
                bindings = _commandMap[binding.commandID];
            
            &#x2F;&#x2F; delete key binding record
            delete _keyMap[normalizedKey];
            
            if (bindings) {
                &#x2F;&#x2F; delete mapping from command to key binding
                _commandMap[binding.commandID] = bindings.filter(function (b) {
                    return (b.key !== normalizedKey);
                });
    
                if (command) {
                    $(command).triggerHandler(&quot;keyBindingRemoved&quot;, [{key: normalizedKey, displayKey: binding.displayKey}]);
                }
            }
        }
    }</code></pre>
                </div>
                <div class="member public">
                    <span class="pull-right scope">
                        
                        Public API
                    </span>
                    <h4>setEnabled</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>A</dt>
                            <dd>(<em>string</em>) - key-description string.</dd>
                            <dt>Returns</dt>
                            <dd>(<em>boolean</em>) - true if the key was processed, false otherwise</dd>
                    </dl>
                    <p>Enable or disable key bindings. Clients such as dialogs may wish to disable <br />global key bindings temporarily.</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function setEnabled(value) {
        _enabled = value;
    }</code></pre>
                </div>
            </section>
        </div>
    </div>
</div>
</body>
</html>