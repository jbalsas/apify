<!DOCTYPE html>
<html lang="en">
<head>
    <title>language.HTMLUtils</title>
    <link rel="stylesheet" href="../assets/css/bootstrap.css">
    <link rel="stylesheet" href="../assets/css/font-awesome.css">
    <link rel="stylesheet" href="../assets/css/main.css">
    <!--[if IE 7]>
    <link rel="stylesheet" href="../assets/css/font-awesome-ie7.css">
    <![endif]-->
    <script type="text/javascript" src="../assets/js/jquery-1.7.js"></script>
    <script type="text/javascript" src="../assets/js/bootstrap.js"></script>
    <script type="text/javascript" src="../assets/js/main.js"></script>
</head>
<body>
<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="brand" href="./index.html">Brackets API</a>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    <li><a href="#dependencies">Dependencies</a></li>
                    <li><a href="#variables">Variables</a></li>
                    <li><a href="#functions">Functions</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="span12">
            <div class="page-header">
                <h1>language.HTMLUtils</h1>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="span3">
            <div class="left-section">
                <ul class="nav nav-list">
                    <li class="nav-header">
                        <a href="#" id="toggle-other-modules"><i class="icon-folder-close"></i> Modules (109)</a>
                    </li>
                </ul>
                <ul id="other-module" class="nav nav-list">
                    <li><a href="brackets.html">brackets</a></li>
                    <li><a href="command.CommandManager.html">command.CommandManager</a></li>
                    <li><a href="command.Commands.html">command.Commands</a></li>
                    <li><a href="command.KeyBindingManager.html">command.KeyBindingManager</a></li>
                    <li><a href="command.Menus.html">command.Menus</a></li>
                    <li><a href="debug.DebugCommandHandlers.html">debug.DebugCommandHandlers</a></li>
                    <li><a href="document.ChangedDocumentTracker.html">document.ChangedDocumentTracker</a></li>
                    <li><a href="document.DocumentCommandHandlers.html">document.DocumentCommandHandlers</a></li>
                    <li><a href="document.DocumentManager.html">document.DocumentManager</a></li>
                    <li><a href="document.TextRange.html">document.TextRange</a></li>
                    <li><a href="editor.CodeHintList.html">editor.CodeHintList</a></li>
                    <li><a href="editor.CodeHintManager.html">editor.CodeHintManager</a></li>
                    <li><a href="editor.CSSInlineEditor.html">editor.CSSInlineEditor</a></li>
                    <li><a href="editor.Editor.html">editor.Editor</a></li>
                    <li><a href="editor.EditorCommandHandlers.html">editor.EditorCommandHandlers</a></li>
                    <li><a href="editor.EditorManager.html">editor.EditorManager</a></li>
                    <li><a href="editor.EditorUtils.html">editor.EditorUtils</a></li>
                    <li><a href="editor.InlineTextEditor.html">editor.InlineTextEditor</a></li>
                    <li><a href="editor.InlineWidget.html">editor.InlineWidget</a></li>
                    <li><a href="editor.MultiRangeInlineEditor.html">editor.MultiRangeInlineEditor</a></li>
                    <li><a href="file.FileUtils.html">file.FileUtils</a></li>
                    <li><a href="file.NativeFileError.html">file.NativeFileError</a></li>
                    <li><a href="file.NativeFileSystem.html">file.NativeFileSystem</a></li>
                    <li><a href="help.HelpCommandHandlers.html">help.HelpCommandHandlers</a></li>
                    <li><a href="language.CSSUtils.html">language.CSSUtils</a></li>
                    <li><a href="language.HTMLUtils.html">language.HTMLUtils</a></li>
                    <li><a href="language.JSLintUtils.html">language.JSLintUtils</a></li>
                    <li><a href="language.JSUtils.html">language.JSUtils</a></li>
                    <li><a href="LiveDevelopment.Agents.ConsoleAgent.html">LiveDevelopment.Agents.ConsoleAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.CSSAgent.html">LiveDevelopment.Agents.CSSAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.DOMAgent.html">LiveDevelopment.Agents.DOMAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.DOMHelpers.html">LiveDevelopment.Agents.DOMHelpers</a></li>
                    <li><a href="LiveDevelopment.Agents.DOMNode.html">LiveDevelopment.Agents.DOMNode</a></li>
                    <li><a href="LiveDevelopment.Agents.EditAgent.html">LiveDevelopment.Agents.EditAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.GotoAgent.html">LiveDevelopment.Agents.GotoAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.HighlightAgent.html">LiveDevelopment.Agents.HighlightAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.NetworkAgent.html">LiveDevelopment.Agents.NetworkAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.RemoteAgent.html">LiveDevelopment.Agents.RemoteAgent</a></li>
                    <li><a href="LiveDevelopment.Agents.RemoteFunctions.html">LiveDevelopment.Agents.RemoteFunctions</a></li>
                    <li><a href="LiveDevelopment.Agents.ScriptAgent.html">LiveDevelopment.Agents.ScriptAgent</a></li>
                    <li><a href="LiveDevelopment.Documents.CSSDocument.html">LiveDevelopment.Documents.CSSDocument</a></li>
                    <li><a href="LiveDevelopment.Documents.HTMLDocument.html">LiveDevelopment.Documents.HTMLDocument</a></li>
                    <li><a href="LiveDevelopment.Documents.JSDocument.html">LiveDevelopment.Documents.JSDocument</a></li>
                    <li><a href="LiveDevelopment.Inspector.Inspector.html">LiveDevelopment.Inspector.Inspector</a></li>
                    <li><a href="LiveDevelopment.LiveDevelopment.html">LiveDevelopment.LiveDevelopment</a></li>
                    <li><a href="LiveDevelopment.main.html">LiveDevelopment.main</a></li>
                    <li><a href="nls.de.strings.html">nls.de.strings</a></li>
                    <li><a href="nls.de.urls.html">nls.de.urls</a></li>
                    <li><a href="nls.es.strings.html">nls.es.strings</a></li>
                    <li><a href="nls.es.urls.html">nls.es.urls</a></li>
                    <li><a href="nls.fr.strings.html">nls.fr.strings</a></li>
                    <li><a href="nls.fr.urls.html">nls.fr.urls</a></li>
                    <li><a href="nls.it.strings.html">nls.it.strings</a></li>
                    <li><a href="nls.it.urls.html">nls.it.urls</a></li>
                    <li><a href="nls.ja.strings.html">nls.ja.strings</a></li>
                    <li><a href="nls.nb.strings.html">nls.nb.strings</a></li>
                    <li><a href="nls.pt-br.strings.html">nls.pt-br.strings</a></li>
                    <li><a href="nls.pt-br.urls.html">nls.pt-br.urls</a></li>
                    <li><a href="nls.root.strings.html">nls.root.strings</a></li>
                    <li><a href="nls.root.urls.html">nls.root.urls</a></li>
                    <li><a href="nls.ru.strings.html">nls.ru.strings</a></li>
                    <li><a href="nls.ru.urls.html">nls.ru.urls</a></li>
                    <li><a href="nls.strings.html">nls.strings</a></li>
                    <li><a href="nls.tr.strings.html">nls.tr.strings</a></li>
                    <li><a href="nls.urls.html">nls.urls</a></li>
                    <li><a href="preferences.PreferencesDialogs.html">preferences.PreferencesDialogs</a></li>
                    <li><a href="preferences.PreferencesManager.html">preferences.PreferencesManager</a></li>
                    <li><a href="preferences.PreferenceStorage.html">preferences.PreferenceStorage</a></li>
                    <li><a href="project.FileIndexManager.html">project.FileIndexManager</a></li>
                    <li><a href="project.FileSyncManager.html">project.FileSyncManager</a></li>
                    <li><a href="project.FileViewController.html">project.FileViewController</a></li>
                    <li><a href="project.ProjectManager.html">project.ProjectManager</a></li>
                    <li><a href="project.SidebarView.html">project.SidebarView</a></li>
                    <li><a href="project.WorkingSetSort.html">project.WorkingSetSort</a></li>
                    <li><a href="project.WorkingSetView.html">project.WorkingSetView</a></li>
                    <li><a href="search.FindInFiles.html">search.FindInFiles</a></li>
                    <li><a href="search.FindReplace.html">search.FindReplace</a></li>
                    <li><a href="search.QuickOpen.html">search.QuickOpen</a></li>
                    <li><a href="strings.html">strings</a></li>
                    <li><a href="utils.AppInit.html">utils.AppInit</a></li>
                    <li><a href="utils.Async.html">utils.Async</a></li>
                    <li><a href="utils.BuildInfoUtils.html">utils.BuildInfoUtils</a></li>
                    <li><a href="utils.CollectionUtils.html">utils.CollectionUtils</a></li>
                    <li><a href="utils.ExtensionLoader.html">utils.ExtensionLoader</a></li>
                    <li><a href="utils.ExtensionUtils.html">utils.ExtensionUtils</a></li>
                    <li><a href="utils.Global.html">utils.Global</a></li>
                    <li><a href="utils.KeyEvent.html">utils.KeyEvent</a></li>
                    <li><a href="utils.NativeApp.html">utils.NativeApp</a></li>
                    <li><a href="utils.PerfUtils.html">utils.PerfUtils</a></li>
                    <li><a href="utils.Resizer.html">utils.Resizer</a></li>
                    <li><a href="utils.ShellAPI.html">utils.ShellAPI</a></li>
                    <li><a href="utils.StringUtils.html">utils.StringUtils</a></li>
                    <li><a href="utils.TokenUtils.html">utils.TokenUtils</a></li>
                    <li><a href="utils.UpdateNotification.html">utils.UpdateNotification</a></li>
                    <li><a href="utils.UrlParams.html">utils.UrlParams</a></li>
                    <li><a href="utils.ViewUtils.html">utils.ViewUtils</a></li>
                    <li><a href="view.ViewCommandHandlers.html">view.ViewCommandHandlers</a></li>
                    <li><a href="widgets.bootstrap-alerts.html">widgets.bootstrap-alerts</a></li>
                    <li><a href="widgets.bootstrap-buttons.html">widgets.bootstrap-buttons</a></li>
                    <li><a href="widgets.bootstrap-dropdown.html">widgets.bootstrap-dropdown</a></li>
                    <li><a href="widgets.bootstrap-modal.html">widgets.bootstrap-modal</a></li>
                    <li><a href="widgets.bootstrap-popover.html">widgets.bootstrap-popover</a></li>
                    <li><a href="widgets.bootstrap-scrollspy.html">widgets.bootstrap-scrollspy</a></li>
                    <li><a href="widgets.bootstrap-tabs.html">widgets.bootstrap-tabs</a></li>
                    <li><a href="widgets.bootstrap-twipsy.html">widgets.bootstrap-twipsy</a></li>
                    <li><a href="widgets.Dialogs.html">widgets.Dialogs</a></li>
                    <li><a href="widgets.ModalBar.html">widgets.ModalBar</a></li>
                    <li><a href="widgets.PopUpManager.html">widgets.PopUpManager</a></li>
                    <li><a href="widgets.StatusBar.html">widgets.StatusBar</a></li>
                </ul>
            </div>
        </div>
        <div class="span9">
            <section>
                <div id="description">
                    <p>lobal define, $</p>
                </div>
            </section>

            <section id="dependencies">
                <h3>Dependencies</h3>
                <ul class="nav nav-list">
                    <li><a href="utils.TokenUtils.html">utils.TokenUtils</a></li>
                </ul>
            </section>

            <section id="variables">
                <h3>Variables <label class="checkbox">
                    <input class="toggle-public" type="checkbox"> Show Private Members
                </label></h3>
                <!--<ul>-->
                <!--</ul>-->
            </section>

            <section id="functions">
                <h3>Functions <label class="checkbox">
                    <input class="toggle-public" type="checkbox"> Show Private Members
                </label></h3>
                <div class="member private">
                    <span class="pull-right scope">
                        Private
                        
                    </span>
                    <h4>_extractAttrVal</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>pos:{ch:{string},</dt>
                            <dd>(<em>editor:CodeMirror, </em>) - line:{number}}, token:{object}} context</dd>
                            <dt>Returns</dt>
                            <dd>(<em></em>) - val:{string}, offset:{number}}</dd>
                    </dl>
                    <p>Sometimes as attr values are getting typed, if the quotes aren't balanced yet<br />some extra 'non attribute value' text gets included in the token. This attempts<br />to assure the attribute value we grab is always good</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function _extractAttrVal(ctx) {
        var attrValue = ctx.token.string,
            startChar = attrValue.charAt(0),
            endChar = attrValue.charAt(attrValue.length - 1),
            offset = TokenUtils.offsetInToken(ctx),
            foundEqualSign = false;
        
        &#x2F;&#x2F;If this is a fully quoted value, return the whole
        &#x2F;&#x2F;thing regardless of position
        if (attrValue.length &gt; 1 &amp;&amp;
                (startChar === &quot;&#39;&quot; || startChar === &#39;&quot;&#39;) &amp;&amp;
                endChar === startChar) {
            
            &#x2F;&#x2F; Find an equal sign before the end quote. If found, 
            &#x2F;&#x2F; then the user may be entering an attribute value right before 
            &#x2F;&#x2F; another attribute and we&#39;re getting a false balanced string.
            &#x2F;&#x2F; An example of this case is &lt;link rel&quot; href=&quot;foo&quot;&gt; where the 
            &#x2F;&#x2F; cursor is right after the first double quote.
            foundEqualSign = (attrValue.match(&#x2F;\=\s*[&#39;&quot;]$&#x2F;) !== null);
            
            if (!foundEqualSign) {
                &#x2F;&#x2F;strip the quotes and return;
                attrValue = attrValue.substring(1, attrValue.length - 1);
                offset = offset - 1 &gt; attrValue.length ? attrValue.length : offset - 1;
                return {val: attrValue, offset: offset, quoteChar: startChar, hasEndQuote: true};
            }
        }
        
        if (foundEqualSign) {
            var spaceIndex = attrValue.indexOf(&quot; &quot;);
            attrValue = attrValue.substring(0, (spaceIndex &gt; offset) ? spaceIndex : offset);
        } else if (offset &gt; 0 &amp;&amp; (startChar === &quot;&#39;&quot; || startChar === &#39;&quot;&#39;)) {
            &#x2F;&#x2F;The att value is getting edit in progress. There is possible extra
            &#x2F;&#x2F;stuff in this token state since the quote isn&#39;t closed, so we assume
            &#x2F;&#x2F;the stuff from the quote to the current pos is definitely in the attribute 
            &#x2F;&#x2F;value.
            attrValue = attrValue.substring(0, offset);
        }
        
        &#x2F;&#x2F;If the attrValue start with a quote, trim that now
        startChar = attrValue.charAt(0);
        if (startChar === &quot;&#39;&quot; || startChar === &#39;&quot;&#39;) {
            attrValue = attrValue.substring(1);
            offset--;
        } else {
            startChar = &quot;&quot;;
        }
        
        return {val: attrValue, offset: offset, quoteChar: startChar, hasEndQuote: false};
    }</code></pre>
                </div>
                <div class="member private">
                    <span class="pull-right scope">
                        Private
                        
                    </span>
                    <h4>_extractTagName</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>pos:{ch:{string},</dt>
                            <dd>(<em>editor:CodeMirror, </em>) - line:{number}}, token:{object}} context</dd>
                            <dt>Returns</dt>
                            <dd>(<em>string</em>) - </dd>
                    </dl>
                    <p>Gets the tagname from where ever you are in the currect state</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function _extractTagName(ctx) {
        if (ctx.token.state.tagName) {
            return ctx.token.state.tagName;           &#x2F;&#x2F;XML mode
        } else if (ctx.token.state.htmlState) {
            return ctx.token.state.htmlState.tagName; &#x2F;&#x2F;HTML mode
        } else if (ctx.token.state.html) {
            return ctx.token.state.html.tagName;      &#x2F;&#x2F;HTML mode for PHP files
        }
        &#x2F;&#x2F; Some mixed modes that offer HTML as a nested mode don&#39;t actually expose the HTML state
        return null;
    }</code></pre>
                </div>
                <div class="member private">
                    <span class="pull-right scope">
                        Private
                        
                    </span>
                    <h4>_getTagInfoStartingFromAttrName</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>pos:{ch:{string},</dt>
                            <dd>(<em>editor:CodeMirror, </em>) - line:{number}}, token:{object}} context</dd>
                            <dt>isPriorAttr</dt>
                            <dd>(<em>boolean</em>) - indicates whether we're getting info for a prior attribute</dd>
                            <dt>Returns</dt>
                            <dd>(<em>string</em>) - </dd>
                    </dl>
                    <p>Gets the taginfo starting from the attribute name and moving forwards</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function _getTagInfoStartingFromAttrName(ctx, isPriorAttr) {
        &#x2F;&#x2F;Verify We&#39;re in the attribute name, move forward and try to extract the rest of
        &#x2F;&#x2F;the info. If the user it typing the attr the rest might not be here
        if (isPriorAttr === false &amp;&amp; ctx.token.className !== &quot;attribute&quot;) {
            return createTagInfo();
        }
        
        var tagName = _extractTagName(ctx);
        var attrName = ctx.token.string;
        var offset = TokenUtils.offsetInToken(ctx);
        
        if (!TokenUtils.moveSkippingWhitespace(TokenUtils.moveNextToken, ctx) || ctx.token.string !== &quot;=&quot;) {
            &#x2F;&#x2F; If we&#39;re checking for a prior attribute and the next token we get is a tag or an html comment or
            &#x2F;&#x2F; an undefined token class, then we&#39;ve already scanned past our original cursor location. 
            &#x2F;&#x2F; So just return an empty tag info.
            if (isPriorAttr &amp;&amp;
                    (!ctx.token.className ||
                    (ctx.token.className !== &quot;attribute&quot; &amp;&amp; ctx.token.string.indexOf(&quot;&lt;&quot;) !== -1))) {
                return createTagInfo();
            }
            return createTagInfo(ATTR_NAME, offset, tagName, attrName);
        }
        
        if (!TokenUtils.moveSkippingWhitespace(TokenUtils.moveNextToken, ctx)) {
            return createTagInfo(ATTR_NAME, offset, tagName, attrName);
        }
        &#x2F;&#x2F;this should be the attrvalue
        var attrInfo = _extractAttrVal(ctx),
            attrVal = attrInfo.val,
            quoteChar = attrInfo.quoteChar,
            hasEndQuote = attrInfo.hasEndQuote;
        
        return createTagInfo(ATTR_NAME, offset, tagName, attrName, attrVal, true, quoteChar, hasEndQuote);
    }</code></pre>
                </div>
                <div class="member private">
                    <span class="pull-right scope">
                        Private
                        
                    </span>
                    <h4>_getTagInfoStartingFromAttrValue</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>pos:{ch:{string},</dt>
                            <dd>(<em>editor:CodeMirror, </em>) - line:{number}}, token:{object}} context</dd>
                            <dt>Returns</dt>
                            <dd>(<em>string</em>) - </dd>
                    </dl>
                    <p>Gets the taginfo starting from the attribute value and moving backwards</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function _getTagInfoStartingFromAttrValue(ctx) {
        &#x2F;&#x2F; Assume we in the attr value
        &#x2F;&#x2F; and validate that by going backwards
        var attrInfo = _extractAttrVal(ctx),
            attrVal = attrInfo.val,
            offset = attrInfo.offset,
            quoteChar = attrInfo.quoteChar,
            hasEndQuote = attrInfo.hasEndQuote,
            strLength = ctx.token.string.length;
        
        if (ctx.token.className === &quot;string&quot; &amp;&amp; ctx.pos.ch === ctx.token.end &amp;&amp; strLength &gt; 1) {
            var firstChar = ctx.token.string[0],
                lastChar = ctx.token.string[strLength - 1];
            
            &#x2F;&#x2F; We get here only when the cursor is immediately on the right of the end quote
            &#x2F;&#x2F; of an attribute value. So we want to return an empty tag info so that the caller
            &#x2F;&#x2F; can dismiss the code hint popup if it is still open.
            if (firstChar === lastChar &amp;&amp; (firstChar === &quot;&#39;&quot; || firstChar === &quot;\&quot;&quot;)) {
                return createTagInfo();
            }
        }
        
        &#x2F;&#x2F;Move to the prev token, and check if it&#39;s &quot;=&quot;
        if (!TokenUtils.moveSkippingWhitespace(TokenUtils.movePrevToken, ctx) || ctx.token.string !== &quot;=&quot;) {
            return createTagInfo();
        }
        
        &#x2F;&#x2F;Move to the prev token, and check if it&#39;s an attribute
        if (!TokenUtils.moveSkippingWhitespace(TokenUtils.movePrevToken, ctx) || ctx.token.className !== &quot;attribute&quot;) {
            return createTagInfo();
        }
        
        var attrName = ctx.token.string;
        var tagName = _extractTagName(ctx);
 
        &#x2F;&#x2F;We&#39;re good. 
        return createTagInfo(ATTR_VALUE, offset, tagName, attrName, attrVal, true, quoteChar, hasEndQuote);
    }</code></pre>
                </div>
                <div class="member public">
                    <span class="pull-right scope">
                        
                        Public API
                    </span>
                    <h4>createTagInfo</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>tokenType</dt>
                            <dd>(<em>string=</em>) - what is getting edited and should be hinted</dd>
                            <dt>offset</dt>
                            <dd>(<em>number=</em>) - where the cursor is for the part getting hinted</dd>
                            <dt>tagName</dt>
                            <dd>(<em>string=</em>) - The name of the tag</dd>
                            <dt>attrName</dt>
                            <dd>(<em>string=</em>) - The name of the attribute</dd>
                            <dt>attrValue</dt>
                            <dd>(<em>string=</em>) - The value of the attribute</dd>
                            <dt>Returns</dt>
                            <dd>(<em>tagName:string, </em>) - </dd>
                    </dl>
                    <p>Creates a tagInfo object and assures all the values are entered or are empty strings</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function createTagInfo(tokenType, offset, tagName, attrName, attrValue, valueAssigned, quoteChar, hasEndQuote) {
        return { tagName: tagName || &quot;&quot;,
                 attr:
                    { name: attrName || &quot;&quot;,
                      value: attrValue || &quot;&quot;,
                      valueAssigned: valueAssigned || false,
                      quoteChar: quoteChar || &quot;&quot;,
                      hasEndQuote: hasEndQuote || false },
                 position:
                    { tokenType: tokenType || &quot;&quot;,
                      offset: offset || 0 } };
    }</code></pre>
                </div>
                <div class="member public">
                    <span class="pull-right scope">
                        
                        Public API
                    </span>
                    <h4>findStyleBlocks</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>editor</dt>
                            <dd>(<em>!Editor</em>) - </dd>
                            <dt>Returns</dt>
                            <dd>(<em>Array.&lt;start:line:number, </em>) - ch:number}, end:{line:number, ch:number}, text:string}>}</dd>
                    </dl>
                    <p>Returns an Array of info about all <style> blocks in the given Editor's HTML document (assumes<br />the Editor contains HTML text).</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function findStyleBlocks(editor) {
        &#x2F;&#x2F; Start scanning from beginning of file
        var ctx = TokenUtils.getInitialContext(editor._codeMirror, {line: 0, ch: 0});
        
        var styleBlocks = [];
        var currentStyleBlock = null;
        var inStyleBlock = false;
        
        while (TokenUtils.moveNextToken(ctx)) {
            if (inStyleBlock) {
                &#x2F;&#x2F; Check for end of this &lt;style&gt; block
                if (ctx.token.state.mode !== &quot;css&quot;) {
                    &#x2F;&#x2F; currentStyleBlock.end is already set to pos of the last CSS token by now
                    currentStyleBlock.text = editor.document.getRange(currentStyleBlock.start, currentStyleBlock.end);
                    inStyleBlock = false;
                } else {
                    currentStyleBlock.end = { line: ctx.pos.line, ch: ctx.pos.ch };
                }
            } else {
                &#x2F;&#x2F; Check for start of a &lt;style&gt; block
                if (ctx.token.state.mode === &quot;css&quot;) {
                    currentStyleBlock = {
                        start: { line: ctx.pos.line, ch: ctx.pos.ch }
                    };
                    styleBlocks.push(currentStyleBlock);
                    inStyleBlock = true;
                }
                &#x2F;&#x2F; else, random token in non-CSS content: ignore
            }
        }
        
        return styleBlocks;
    }
    
    
    &#x2F;&#x2F; Define public API
    exports.TAG_NAME = TAG_NAME;
    exports.ATTR_NAME = ATTR_NAME;
    exports.ATTR_VALUE = ATTR_VALUE;
    
    exports.getTagInfo = getTagInfo;
    exports.getTagAttributes = getTagAttributes;
    &#x2F;&#x2F;The createTagInfo is really only for the unit tests so they can make the same structure to 
    &#x2F;&#x2F;compare results with
    exports.createTagInfo = createTagInfo;
    exports.findStyleBlocks = findStyleBlocks;
});</code></pre>
                </div>
                <div class="member public">
                    <span class="pull-right scope">
                        
                        Public API
                    </span>
                    <h4>getTagAttributes</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>editor</dt>
                            <dd>(<em>CodeMirror</em>) - An instance of a CodeMirror editor</dd>
                            <dt>line:{number}}</dt>
                            <dd>(<em>ch:string, </em>) - pos A CodeMirror position</dd>
                            <dt>Returns</dt>
                            <dd>(<em>Array.&lt;string&gt;</em>) - A list of the used attributes inside the current tag</dd>
                    </dl>
                    <p>Compiles a list of used attributes for a given tag</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function getTagAttributes(editor, pos) {
        var attrs       = [],
            backwardCtx = TokenUtils.getInitialContext(editor._codeMirror, pos),
            forwardCtx  = $.extend({}, backwardCtx);
        
        if (editor.getModeForSelection() === &quot;html&quot;) {
            if (backwardCtx.token &amp;&amp; backwardCtx.token.className !== &quot;tag&quot;) {
                while (TokenUtils.movePrevToken(backwardCtx) &amp;&amp; backwardCtx.token.className !== &quot;tag&quot;) {
                    if (backwardCtx.token.className === &quot;attribute&quot;) {
                        attrs.push(backwardCtx.token.string);
                    }
                }
                
                while (TokenUtils.moveNextToken(forwardCtx) &amp;&amp; forwardCtx.token.className !== &quot;tag&quot;) {
                    if (forwardCtx.token.className === &quot;attribute&quot;) {
                        attrs.push(forwardCtx.token.string);
                    } else if (forwardCtx.token.className === &quot;error&quot;) {
                        &#x2F;&#x2F; If we type the first letter of the next attribute, it comes as an error
                        &#x2F;&#x2F; token. We need to double check for possible invalidated attributes.
                        if (forwardCtx.token.string.trim() !== &quot;&quot; &amp;&amp;
                                forwardCtx.token.string.indexOf(&quot;\&quot;&quot;) === -1 &amp;&amp;
                                forwardCtx.token.string.indexOf(&quot;&#39;&quot;) === -1 &amp;&amp;
                                forwardCtx.token.string.indexOf(&quot;=&quot;) === -1) {
                            attrs.push(forwardCtx.token.string);
                        }
                    }
                }
            }
        }
        
        return attrs;
    }</code></pre>
                </div>
                <div class="member public">
                    <span class="pull-right scope">
                        
                        Public API
                    </span>
                    <h4>getTagInfo</h4>
                    <!--<strong>Params:</strong>-->
                    <dl>
                            <dt>editor</dt>
                            <dd>(<em>Editor</em>) - An instance of a Brackets editor</dd>
                            <dt>number,</dt>
                            <dd>(<em>ch:</em>) - line: number}} constPos A CM pos (likely from editor.getCursor())</dd>
                            <dt>Returns</dt>
                            <dd>(<em>tagName:string, </em>) - </dd>
                    </dl>
                    <p>Figure out if we're in a tag, and if we are return info about it<br />An example token stream for this tag is <span id="open-files-disclosure-arrow"></span> : <br />     className:tag       string:"<span"<br />     className:          string:" "<br />     className:attribute string:"id"<br />     className:          string:"="<br />     className:string    string:""open-files-disclosure-arrow""<br />     className:tag       string:"></span>"</p>
                    <button class="btn btn-small show-code">Show code</button>
                    <pre class="code"><code>function getTagInfo(editor, constPos) {
        &#x2F;&#x2F; We&#39;re going to be changing pos a lot, but we don&#39;t want to mess up
        &#x2F;&#x2F; the pos the caller passed in so we use extend to make a safe copy of it.	
        var pos = $.extend({}, constPos),
            ctx = TokenUtils.getInitialContext(editor._codeMirror, pos),
            tempCtx = null,
            offset = TokenUtils.offsetInToken(ctx),
            tagInfo,
            tokenType;
        
        &#x2F;&#x2F; check if this is inside a style block.
        if (editor.getModeForSelection() !== &quot;html&quot;) {
            return createTagInfo();
        }
        
        &#x2F;&#x2F;check and see where we are in the tag
        if (ctx.token.string.length &gt; 0 &amp;&amp; ctx.token.string.trim().length === 0) {

            &#x2F;&#x2F; token at (i.e. before) pos is whitespace, so test token at next pos
            &#x2F;&#x2F;
            &#x2F;&#x2F; note: getTokenAt() does range checking for ch. If it detects that ch is past
            &#x2F;&#x2F; EOL, it uses EOL, same token is returned, and the following condition fails,
            &#x2F;&#x2F; so we don&#39;t need to worry about testPos being valid.
            var testPos = {ch: ctx.pos.ch + 1, line: ctx.pos.line},
                testToken = editor._codeMirror.getTokenAt(testPos);

            if (testToken.string.length &gt; 0 &amp;&amp; testToken.string.trim().length &gt; 0 &amp;&amp;
                    testToken.string.charAt(0) !== &quot;&gt;&quot;) {
                &#x2F;&#x2F; pos has whitespace before it and non-whitespace after it, so use token after
                ctx.token = testToken;

                if (ctx.token.className === &quot;tag&quot;) {
                    &#x2F;&#x2F; Check to see if the cursor is just before a &quot;&lt;&quot; but not in any tag.
                    if (ctx.token.string.charAt(0) === &quot;&lt;&quot;) {
                        return createTagInfo();
                    }
                } else if (ctx.token.className === &quot;attribute&quot;) {
                    &#x2F;&#x2F; Check to see if the user is going to add a new attr before an existing one
                    return _getTagInfoStartingFromAttrName(ctx, false);
                } else if (ctx.token.string === &quot;=&quot;) {
                    &#x2F;&#x2F; We&#39;re between a whitespace and  &quot;=&quot;, so return an empty tag info.
                    return createTagInfo();
                }
            } else {
                &#x2F;&#x2F; We get here if &quot;&gt;&quot; or white spaces after testPos.
                &#x2F;&#x2F; Check if there is an equal sign after testPos by creating a new ctx
                &#x2F;&#x2F; with the original pos. We can&#39;t use the current ctx since we need to 
                &#x2F;&#x2F; use it to scan backwards if we don&#39;t find an equal sign here.
                &#x2F;&#x2F; Comment out this block to fix issue #1510.
&#x2F;&#x2F;                if (testToken.string.length &gt; 0 &amp;&amp; testToken.string.charAt(0) !== &quot;&gt;&quot;) {
&#x2F;&#x2F;                    tempCtx = TokenUtils.getInitialContext(editor._codeMirror, pos);
&#x2F;&#x2F;                    if (TokenUtils.moveSkippingWhitespace(TokenUtils.moveNextToken, tempCtx) &amp;&amp; tempCtx.token.string === &quot;=&quot;) {
&#x2F;&#x2F;                        &#x2F;&#x2F; Return an empty tag info since we&#39;re between an atribute name and the equal sign.
&#x2F;&#x2F;                        return createTagInfo();
&#x2F;&#x2F;                    }
&#x2F;&#x2F;                }

                &#x2F;&#x2F; next, see what&#39;s before pos
                if (!TokenUtils.movePrevToken(ctx)) {
                    return createTagInfo();
                }

                if (ctx.token.className === &quot;comment&quot;) {
                    return createTagInfo();
                } else if (ctx.token.className !== &quot;tag&quot; &amp;&amp; ctx.token.string !== &quot;=&quot;) {
                    &#x2F;&#x2F; If it wasn&#39;t the tag name, assume it was an attr value
                    &#x2F;&#x2F; Also we don&#39;t handle the &quot;=&quot; here.
                    tagInfo = _getTagInfoStartingFromAttrValue(ctx);

                    &#x2F;&#x2F; Check to see if this is the closing of a tag (either the start or end)
                    &#x2F;&#x2F; or a comment tag.
                    if (ctx.token.className === &quot;comment&quot; ||
                            (ctx.token.className === &quot;tag&quot; &amp;&amp;
                            (ctx.token.string === &quot;&gt;&quot; || ctx.token.string === &quot;&#x2F;&gt;&quot; ||
                                (ctx.token.string.charAt(0) === &quot;&lt;&quot; &amp;&amp; ctx.token.string.charAt(1) === &quot;&#x2F;&quot;)))) {
                        return createTagInfo();
                    }
                    
                    &#x2F;&#x2F; If it wasn&#39;t an attr value, assume it was an empty attr (ie. attr with no value)
                    if (!tagInfo.tagName) {
                        tagInfo = _getTagInfoStartingFromAttrName(ctx, true);
                    }

                    &#x2F;&#x2F; We don&#39;t want to give context for the previous attr
                    &#x2F;&#x2F; and we want it to look like the user is going to add a new attr
                    if (tagInfo.tagName) {
                        return createTagInfo(ATTR_NAME, 0, tagInfo.tagName);
                    }
                    return createTagInfo();
                }
                
                &#x2F;&#x2F; We know the tag was here, so the user is adding an attr name
                tokenType = ATTR_NAME;
                offset = 0;
            }
        }
        
        if (ctx.token.className === &quot;tag&quot;) {
            &#x2F;&#x2F; Check if the user just typed a white space after &quot;&lt;&quot; that made an existing tag invalid.
            if (ctx.token.string.match(&#x2F;^&lt;\s+&#x2F;) &amp;&amp; offset !== 1) {
                return createTagInfo();
            }
            
            &#x2F;&#x2F; Check to see if this is the closing of a tag (either the start or end)
            if (ctx.token.string === &quot;&gt;&quot; || ctx.token.string === &quot;&#x2F;&gt;&quot; ||
                    (ctx.token.string.charAt(0) === &quot;&lt;&quot; &amp;&amp; ctx.token.string.charAt(1) === &quot;&#x2F;&quot;)) {
                return createTagInfo();
            }
            
            if (!tokenType) {
                tokenType = TAG_NAME;
                offset--; &#x2F;&#x2F;need to take off 1 for the leading &quot;&lt;&quot;
            }
            
            &#x2F;&#x2F; We&#39;re actually in the tag, just return that as we have no relevant 
            &#x2F;&#x2F; info about what attr is selected
            return createTagInfo(tokenType, offset, _extractTagName(ctx));
        }
        
        if (ctx.token.string === &quot;=&quot;) {
            &#x2F;&#x2F; We could be between the attr and the value
            &#x2F;&#x2F; Step back and check
            if (!TokenUtils.moveSkippingWhitespace(TokenUtils.movePrevToken, ctx) || ctx.token.className !== &quot;attribute&quot;) {
                return createTagInfo();
            }
            
            &#x2F;&#x2F; The &quot;=&quot; is added, time to hint for values
            tokenType = ATTR_VALUE;
            offset = 0;
        }
        
        if (ctx.token.className === &quot;attribute&quot;) {
            tagInfo = _getTagInfoStartingFromAttrName(ctx, false);
            
            &#x2F;&#x2F; If we&#39;re in attr value, then we may need to calculate the correct offset
            &#x2F;&#x2F; from the beginning of the attribute value. If the cursor position is to 
            &#x2F;&#x2F; the left of attr value, then the offset is negative.
            &#x2F;&#x2F; e.g. if the cursor is just to the right of the &quot;=&quot; in &lt;a rel= &quot;rtl&quot;, then
            &#x2F;&#x2F; the offset will be -2.
            if (tagInfo.attr.quoteChar) {
                offset = constPos.ch - ctx.pos.ch;
            } else if (tokenType === ATTR_VALUE &amp;&amp; (constPos.ch + 1) &lt; ctx.pos.ch) {
                &#x2F;&#x2F; The cursor may be right before an unquoted attribute or another attribute name.
                &#x2F;&#x2F; Since we can&#39;t distinguish between them, we will empty the value so that the 
                &#x2F;&#x2F; caller can just insert a new attribute value.
                tagInfo.attr.value = &quot;&quot;;
            }
        } else {
            &#x2F;&#x2F; if we&#39;re not at a tag, &quot;=&quot;, or attribute name, assume we&#39;re in the value
            tagInfo = _getTagInfoStartingFromAttrValue(ctx);
        }
        
        if (tokenType &amp;&amp; tagInfo.tagName) {
            tagInfo.position.tokenType = tokenType;
            tagInfo.position.offset = offset;
        }
        
        return tagInfo;
    }</code></pre>
                </div>
            </section>
        </div>
    </div>
</div>
</body>
</html>